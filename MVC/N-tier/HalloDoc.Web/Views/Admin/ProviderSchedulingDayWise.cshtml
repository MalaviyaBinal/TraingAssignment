﻿@using System.Text.Json
@using System.Text.Json.Serialization
@model HalloDocWebEntity.ViewModel.ShiftDetailsModel
@{
    Layout = "_AdminHeader";
}
<link rel="stylesheet" href="~/css/Scheduling.css" />
<script src="~/js/daypilot-all.min.js"></script>
<div class="container ">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between mt-3">
                <h4 class="mt-3">Scheduling</h4>
                <a class="text-start text-info text-decoration-none " asp-action="AdminProvider" asp-controller="Admin">
                    <button class="btn btn-white  text-info border-info rounded ">
                        <i class="fa-solid  fa-less-than"></i> Back
                    </button>
                </a>
            </div>
            <div class=" container rounded bg-white shadow py-3 ">
                <div class="d-flex align-items-center justify-content-between my-3">
                    <div class="col-md-4 col-sm-12">
                        <select class="form-select form-select-lg" id="Regions">

                            <option selected><i class="fa fa-search text-muted position-absolute" style="padding-top:10px; padding-left:10px;"></i>All Regions</option>

                        </select>
                    </div>

                    <div>
                        <button class="btn btn-info text-white me-2">Providers On Call</button>
                        <button class="btn btn-info text-white me-2">Shifts for Review</button>
                        <button class="btn btn-info text-white me-1" onclick="ModalofShift()">Add New Shift</button>
                    </div>

                </div>

                <div>
                    <div class="h5  heading">Monday,Dec 4 2023</div>
                </div>
                <div class="text-end mb-3">
                    <i class="bi bi-square-fill" style="color: #ff80ff;"></i>
                    <span class="me-2">Pending Shifts</span>
                    <i class="bi bi-square-fill" style="color: #00cc00;"></i>
                    <span>Approved Shifts</span>
                </div>

                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <a href="javascript:dp.startDate = dp.startDate.addDays(-1); dp.update();" class="text-decoration-none">
                            <i class="fa-solid fa-less-than text-white p-2" style="background-color:#1ad1ff;border-radius:20px;"></i>
                        </a>
                        <span style="height:20px;" id="change"><i class="bi bi-calendar3"></i> </span>
                        <a href="javascript:dp.startDate = dp.startDate.addDays(1); dp.update();">
                            <i class="fa-solid fa-greater-than text-white p-2 me-2" style="background-color:#1ad1ff;border-radius:20px;"></i>
                        </a>
                    </div>
                    <div>
                        <a asp-action="ProviderSchedulingDayWise" asp-controller="Admin"> <button class="btn btn-info text-white me-2">Day</button></a>
                        <a asp-action="ProviderSchedulingWeekWise" asp-controller="Admin"> <button class="btn btn-outline-info  me-2">Week</button></a>
                        <a asp-action="ProviderSchedulingMonthWise" asp-controller="Admin"> <button class="btn btn-outline-info">Month</button></a>
                    </div>
                </div>
            </div>
            <span id="start" class="hide"></span>
            <div class="main">
                <div id="dp"></div>
            </div>
        </div>
    </div>
</div>
<div id="modalpopup">
</div>


<script>
    function ModalofShift() {
        console.log("dfdf");
        $.ajax({
            url: "/Admin/OpenAddShiftModal",
           
            type: "GET",
            dataType: "html",
            success: function (data) {
                $("#modalpopup").html(data);
            },
            error: function () {
                alert("No Projects Found");
                $("#tableContent").html('An error has occurred');
            }
        });
    };
</script>
<script type="text/javascript">
    debugger;
    console.log("hello");

    @{
        JsonSerializerOptions options = new JsonSerializerOptions
            {
                ReferenceHandler = ReferenceHandler.Preserve
            };

        string listJson = System.Text.Json.JsonSerializer.Serialize(Model.physicians, options);
        string eventsJson = System.Text.Json.JsonSerializer.Serialize(Model.shiftDetails, options);


    }

                        const resourcess = @Html.Raw(listJson);
    const eventss = @Html.Raw(eventsJson);
    console.log(eventss)

    const picker = new DayPilot.DatePicker({
        target: 'start',
        pattern: 'yyyy-MM-dd',
        resetTarget: true,
        onTimeRangeSelected: args => {
            dp.update({
                startDate: args.start
            });
        }
    });

    const dp = new DayPilot.Scheduler("dp", {
        cellWidthSpec: "Auto",
        timeHeaders: [{ "groupBy": "Day", "format": "dddd, MMM dd, yyyy" }, { "groupBy": "Hour" }],
        scale: "Hour",
        days: 1,
        startDate: DayPilot.Date.today(),
        businessBeginsHour: 8,
        businessEndsHour: 21,
        eventHeight: 40,
        timeRangeSelectedHandling: "Enabled",
        //onTimeRangeSelected: async (args) => {
        //    const dp = args.control;
        //    const modal = await DayPilot.Modal.prompt("Create a new event:", "Event 1");
        //    dp.clearSelection();
        //    if (modal.canceled) { return; }
        //    dp.events.add({
        //        start: args.start,
        //        end: args.end,
        //        id: DayPilot.guid(),
        //        resource: args.resource,
        //        text: modal.result
        //    });
        //},
        eventMoveHandling: "Update",
        onEventMoved: (args) => {
            args.control.message("Event moved: " + args.e.text());
        },
        eventResizeHandling: "Update",
        onEventResized: (args) => {
            args.control.message("Event resized: " + args.e.text());
        },
        eventDeleteHandling: "Update",
        onEventDeleted: (args) => {
            args.control.message("Event deleted: " + args.e.text());
        },
        eventClickHandling: "Disabled",
        eventHoverHandling: "Bubble",
        bubble: new DayPilot.Bubble({
            onLoad: (args) => {
                // if the event object doesn't specify "bubbleHtml" property
                // this onLoad handler will be called to provide the bubble HTML
                args.html = "Event details";
            }
        }),
        treeEnabled: true,
    });


    // dp.resources = [
    //     { name: "Resource 1", id: "R1" },
    //     { name: "Resource 2", id: "R2" },
    //     { name: "Resource 3", id: "R3" },
    //     { name: "Resource 4", id: "R4" },
    //     { name: "Resource 5", id: "R5" },
    //     { name: "Resource 6", id: "R6" },
    //     { name: "Resource 7", id: "R7" },
    //     { name: "Resource 8", id: "R8" },
    //     { name: "Resource 9", id: "R9" },
    // ];
    dp.events.list = [];
    dp.init();


    const app = {
        elements: {
            previous: document.getElementById("previous"),
            next: document.getElementById("next"),
            start: document.querySelector("#start"),
            change: document.querySelector("#change")
        },
        loadData() {
            const resources = [{ html: "<b>Coverage</b>", id: "R0" }];
            console.log(resourcess['$values']);
            for (let i = 0; i < resourcess['$values'].length; ++i) {
                let path = resourcess['$values'][i].Photo == null ? "/PhysicianDoc/user (1).jpg" : `/PhysicianDoc/${resourcess['$values'][i].Physicianid}/${resourcess['$values'][i].Photo}.jpg`;
                let obj = {
                    html: `<div class='coverage-flex'><div class='coverage-inner-flex'><img style='width:15px;height:15px;' src='${path}' class='coverage-img' /><span>${resourcess['$values'][i].Lastname.charAt(0).toUpperCase() + resourcess['$values'][i].Lastname.slice(1) + ", " + resourcess['$values'][i].Firstname.charAt(0).toUpperCase() + "."}</span></div></div>`,
                    id: resourcess['$values'][i].Physicianid
                }
                resources.push(obj);
            }

            const events = []

            for (let i = 0; i < eventss['$values'].length; ++i) {
                let obj = {
                    id: eventss['$values'][i].Shiftdetailid,
                    text: `${new DayPilot.Date(eventss['$values'][i].Shiftdate.split("T")[0] + "T" + eventss['$values'][i].Starttime).toString("h:mm tt")} - ${new DayPilot.Date(eventss['$values'][i].Shiftdate.split("T")[0] + "T" + eventss['$values'][i].Endtime).toString("h:mm tt")} `,
                    start: eventss['$values'][i].Shiftdate.split("T")[0] + "T" + eventss['$values'][i].Starttime,
                    end: eventss['$values'][i].Shiftdate.split("T")[0] + "T" + eventss['$values'][i].Endtime,
                    resource: eventss['$values'][i].Physicianid,
                    regionid: eventss['$values'][i].RegionName,
                    backColor: eventss['$values'][i].Status == 0 ? "#EEACD0" : "#A1D0A2"
                }
                events.push(obj)
            }
            console.log(events)
            dp.update({ resources, events });
          
        },
        barColor(i) {
            const colors = ["#3c78d8", "#6aa84f", "#f1c232", "#cc0000"];
            return colors[i % 4];
        },
        init() {
            this.addEventHandlers();
            this.loadData();
        },
        addEventHandlers() {
            // this.elements.previous.addEventListener("click", () => {
            //     // ev.preventDefault();
            //     dp.update({
            //         startDate: dp.startDate.addMonths(-1)
            //     });
            // });
            // this.elements.next.addEventListener("click", (ev) => {
            //     ev.preventDefault();
            //     dp.update({
            //         startDate: dp.startDate.addMonths(1)
            //     });
            // });

            this.elements.change.addEventListener("click", (ev) => {
                ev.preventDefault();
                picker.show();
            });
        }
    };

    app.init();

    document.querySelector(".scheduler_default_corner_inner").nextElementSibling.style.display = "none";

</script>
<script>
    document.getElementById("provider").classList.add("active");
</script>



@*@model HalloDocWebEntity.ViewModel.SchedulingViewModel;
@{
    Layout = "_AdminHeader";
}
    <div class="container min-vh-100 d-flex flex-column justify-content-between create-patient-req-main full-content">
        <form method="post" class="row row-cols-1" enctype="multipart/form-data">
            <div class="main-create-patient-req d-flex justify-content-center align-items-center mt-1">
                <div class="row row-cols-1 justify-content-center align-items-center width-create-patient-req ">
                    <div class="col  d-flex justify-content-between gy-3">
                        <h3>Scheduling</h3>
                        
                    </div>
                    <div class="col d-flex flex-row justify-content-between gy-3">
                        <select id="region" name="region" class="form-select m-1 w-25" aria-label="Default select example">
                            <option selected>Select Region</option>
                        </select>
                        <div>
                            <button role="button" class="btn btn-info p-1 text-white mb-3">Providers On Call</button>
                            <button role="button"  class="btn btn-info p-1 text-white mb-3">Shifts For Review</button>
                        <a role="button" id="create-shift" data-bs-toggle="modal" data-bs-target="#modalShift"  class="btn btn-info p-1 text-white mb-3">Add New Shift</a>
                        </div>
                    </div>
                    <div class="col gy-3">
                        <h5>Monday, Dec 4,2023</h5>
                    </div>
                    <div class="col d-flex flex-row justify-content-end gy-3">
                        <div class="m-1 p-0 rounded" style="background-color:pink; width:5%;  opacity:0.5;"></div>
                        <div class="m-2 ">Pending Shifts</div>
                        <div class="m-1 rounded" style="background-color:green; width:5%; opacity:0.5;"></div>
                        <div class="m-2">Approved Shifts</div>
                    </div>
                    <div class="col gy-3">
                        <span class="p-2 m-1" style="border-radius: 50%; color:white; background: #01bce9;"><</span>
                        <i class="fa-solid fa-calendar-days" style="color:grey;"> </i>
                        <span class="p-2 m-1" style="border-radius: 50%; color:white; background: #01bce9;">></span>
                    </div>
                    <div class="col d-flex flex-row justify-content-end gy-3">
                        <button role="button" class="btn btn-outline-info m-2">Day</button>
                        <button role="button" class="btn btn-outline-info  m-2">Week</button>
                        <button role="button" class="btn btn-outline-info  m-2">Month</button>
                    </div>
                    <div class="col-12">
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th scope="col">Staff</th>
                                    <th scope="col">12A</th>
                                    <th scope="col">1A</th>
                                    <th scope="col">2A</th>
                                    <th scope="col">3A</th>
                                    <th scope="col">4A</th>
                                    <th scope="col">5A</th>
                                    <th scope="col">6A</th>
                                    <th scope="col">7A</th>
                                    <th scope="col">8A</th>
                                    <th scope="col">9A</th>
                                    <th scope="col">10A</th>
                                    <th scope="col">11A</th>
                                    <th scope="col">12P</th>
                                    <th scope="col">1P</th>
                                    <th scope="col">2P</th>
                                    <th scope="col">3P</th>
                                    <th scope="col">4P</th>
                                    <th scope="col">5P</th>
                                    <th scope="col">6P</th>
                                    <th scope="col">7P</th>
                                    <th scope="col">8P</th>
                                    <th scope="col">9P</th>
                                    <th scope="col">10P</th>
                                    <th scope="col">11P</th>
                                </tr>
                            </thead>
                            <tbody class="coverage">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </form>
     
    </div>
    <!--For create shift-->
    <div class="modal" id="modalShift">
        <div class="modal-dialog">
            <div class="modal-content">
                <form id="createShiftForm" asp-controller="Admin" asp-action="insertShift" method="POST">
                    <!-- Modal Header -->
                    <div class="modal-header" style="background:#01bce9; color:white;">
                        <h4 class="modal-title">Create Shift</h4>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body" style="color:grey;">
                        <select asp-for="RegionId" class="form-select mb-3 region" aria-label="Default select example">
                            <option selected>Select Region</option>
                        </select>
                        <select asp-for="PhysicianId" id="physician" class="form-select mb-3" aria-label="Default select example">
                            <option selected>Select Physician</option>
                        </select>
                        <div class="form-floating mb-3">
                            <input asp-for="ShiftDate" type="date" class="form-control dob-create-patient shadow-none" id="floatingInput" placeholder="">
                            <label class="dob-create-patient-text" for="floatingInput">Shift Date</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input asp-for="StartTime" type="time" class="form-control dob-create-patient shadow-none" placeholder="">
                            <label class="dob-create-patient-text">Start</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input asp-for="EndTime" type="time" class="form-control dob-create-patient shadow-none" placeholder="">
                            <label class="dob-create-patient-text">End</label>
                        </div>
                        <input name="checktoggle" type="checkbox" id="toggle" />
                        <label class="toggle-label" for="toggle"></label>
                        <div class="d-flex  mb-1">
                            <input class="m-2" type="checkbox" id="sun" name="dayList" value="1">
                            <span for="sun"> Every Sunday</span>
                            <input class="m-2" type="checkbox" id="mon" name="dayList" value="2">
                            <span for="mon"> Every Monday</span>
                            <input class="m-2" type="checkbox" id="tue" name="dayList" value="3">
                            <span for="tue"> Every Tuesday</span>
                        </div>
                        <div class="d-flex justify-content-around mb-1">
                            <input type="checkbox" id="wed" name="dayList" value="4">
                            <span for="wed"> Every Wednesday</span>
                            <input type="checkbox" id="thur" name="dayList" value="5">
                            <span for="thur"> Every Thursday</span>
                            <input type="checkbox" id="fri" name="dayList" value="6">
                            <span  for="fri"> Every Friday</span>
                        </div>
                    <input class="m-2" type="checkbox" class="mb-3" id="sat" name="dayList" value="7">
                        <span for="sat"> Every Saturday</span>
                        <select asp-for="RepeatUpto" id="repeat" class="form-select mb-3" aria-label="Default select example">
                            <option selected>Repeat End</option>
                            <option value="1">1-time</option>
                            <option value="2">2-times</option>
                            <option value="3">3-times</option>
                        </select>
                    </div>
                    <!-- Modal footer -->
                    <div class="modal-footer">
                        <button type="submit" class="btn submit-btn-assigncase">Submit</button>
                        <button type="button" class="btn cancel-btn-cancelcase" data-bs-dismiss="modal">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
*@