@model List<HalloDocWebEntity.ViewModel.TimeSheetViewModel>
@{
    ViewData["Title"] = "InvoicingProvider";
    Layout = "_ProviderHeader";
    DateTime date = DateTime.Now;
}
<style>
    .documentBtn {
        width: fit-content;
    }
</style>
<div class="container">
    <div class="tab-pane show active px-4" id="access" role="tabpanel" aria-labelledby="providers-tab">
        <div class="row my-3">
            <div class="col">
                <h3 class="ms-2">TimeSheets</h3>
            </div>
            <div class=" col text-end">
                <a asp-controller="Admin" asp-action="Invoicing">
                    <button class=" btn btn-outline-info me-2 ">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-left" viewBox="0 0 16 20">
                            <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0" />
                        </svg>Back
                    </button>
                </a>
            </div>
        </div>
        <div class="  shadow rounded py-3 my-3">
            <div class=" row p-3 ">
                <div class=" col form-floating table-responsive mb-3">
                    <table class="table ">
                        <colgroup>
                            <col style="width: 13%" />
                            <col style="width: 7%" />
                            <col style="width: 20%" />
                            <col style="width: 10%" />
                            <col style="width: 25%" />
                            <col style="width: 25%" />
                        </colgroup>
                        <thead>
                            <tr class="table-secondary">
                                <td>Date</td>
                                <td>On-call Hours</td>
                                <td>Total Hours</td>
                                <td>Weekend/Holiday</td>
                                <td>Number of Housecalls</td>
                                <td>Number of Phone Concults</td>
                            </tr>
                        </thead>
                        <tbody>
                            <form asp-action="SaveTimesheet" method="post">
                                <input type="hidden" value="@Model.FirstOrDefault().StartDate" name="StartDate" />
                                <input type="hidden" value="@Model.FirstOrDefault().EndDate" name="EndDate" />
                                @foreach (var timesheet in Model)
                                {
                                <tr>
                                    <td>@timesheet.Date.ToShortDateString()</td>
                                    <td><input type="number" name="OnCallHours" value="@timesheet.OnCallHours" class="form-control border-0" readonly /></td>
                                    <td><input type="number" name="TotalHours" value="@timesheet.TotalHours" class="form-control" /></td>
                                    <td>
                                            @if (timesheet.WeekendHoliday == true)
                                            {
                                            <input type="checkbox" name="WeekendHoliday" value="@timesheet.Date.Day" class="form-check-input" checked />
                                            }
                                            else
                                            {
                                            <input type="checkbox" name="WeekendHoliday" value="@timesheet.Date.Day" class="form-check-input" />
                                            }
                                    </td>
                                    <td><input type="number" name="NumberOfHouseCalls" value="@timesheet.NumberOfHouseCalls" class="form-control" /></td>
                                    <td><input type="number" name="NumberOfPhoneConsults" value="@timesheet.NumberOfPhoneConsults" class="form-control" /></td>
                                </tr>
                                }
                            <tr>
                                <td colspan="6" class="text-end">
                                    <button type="submit" class="btn btn-info text-white ">Submit</button>
                                </td>
                            </tr>
                            </form>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col">
                <button onclick="OpenReceipt()" class="btn btn-info text-white ms-4"> Add Receipt</button>
            </div>
        </div>
        <div class="" id="ReceiptForm" style="display:none;">
            <div class=" shadow rounded py-3 my-3">
                <div class=" row p-3 ">
                    <div class=" col form-floating table-responsive mb-3">
                        <table class="table ">
                            <colgroup>
                                <col style="width: 15%" />
                                <col style="width: 15%" />
                                <col style="width: 15%" />
                                <col style="width: 30%" />
                                <col style="width: 25%" />
                            </colgroup>
                            <thead>
                                <tr class="table-secondary">
                                    <td>Date</td>
                                    <td>Item</td>
                                    <td>Amount</td>
                                    <td>Bill</td>
                                    <td>Action</td>
                                </tr>
                            </thead>
                            <tbody>
                                @if (true)
                                {
                                    int id1 = 0;
                                    @foreach (var timesheet in Model)
                                    {
                                        <form asp-action="SaveReimbursement" method="post" enctype="multipart/form-data">
                                            <input type="hidden" value="@Model.FirstOrDefault().StartDate" name="StartDate" id="StartDate" />
                                            <input type="hidden" value="@Model.FirstOrDefault().EndDate" name="EndDate" id="StartDate" />
                                            <input type="hidden" value="@id1" name="Gap" />
                                        <tr>
                                            <td>@timesheet.Date.ToShortDateString()</td>
                                                @if (timesheet.Item != null)
                                                {
                                                    var str = "item" + id1;
                                                <td><input type="text" id="@str" name="Item" onkeyup="Enablefile(@id1)" value="@timesheet.Item" class="form-control" disabled /></td>
                                                    str = "itemVal" + id1;
                                                <input type="hidden" value="@timesheet.Item" id="@str" />
                                                }
                                                else
                                                {
                                                    var str = "item" + id1;
                                                <td><input type="text" id="@str" name="Item" onkeyup="Enablefile(@id1)" value="@timesheet.Item" class="form-control" /></td>
                                                }
                                                @if (timesheet.Amount != 0)
                                                {
                                                    var str = "amount" + id1;
                                                <td><input type="number" name="Amount" id=@str onkeyup="Enablefile(@id1)" value="@timesheet.Amount" class="form-control" disabled /></td>
                                                    str = "amountVal" + id1;
                                                <input type="hidden" value="@timesheet.Amount" id="@str" />
                                                }
                                                else
                                                {
                                                    var str = "amount" + id1;
                                                <td>
                                                    <input type="number" name="Amount" id=@str onkeyup="Enablefile(@id1)" value="@timesheet.Amount" class="form-control" />
                                                </td>
                                                }
                                                @if (timesheet.FileName != null)
                                                {
                                                <td>@timesheet.FileName</td>
                                                }
                                                else
                                                {
                                                    var str = "ReceiptFile" + id1;
                                                <td><input type="file" id=@str onchange="SaveData(@id1)" name="ReceiptFile" disabled></td>
                                                }
                                            <td>
                                                    @if (timesheet.Item != null)
                                                    {
                                                        var str = "edit" + id1;
                                                    <button class="btn btn-info text-white" id=@str type="button" onclick="EditReceipt(@id1)">Edit</button>
                                                        str = "save" + id1;
                                                    <button onclick="EditReimbursement(@id1)" class="btn btn-info text-white " type="button" style="display:none;" id="@str">Save</button>
                                                        str = "cancel" + id1;
                                                    <button onclick="CancelReimbursement(@id1)" class="btn btn-outline-info " type="button" style="display:none;" id="@str">Cancel</button>
                                                        str = "delete" + id1;
                                                    <a class="btn btn-info text-white" id=@str type="button" asp-action="DeleteReimbursement" asp-route-Gap="@id1" asp-route-StartDate="@Model.First().StartDate">Delete</a>
                                                        str = "view" + id1;
                                                        var str1 = "/PhysicianDoc/" + timesheet.PhysicianId + "/" + @timesheet.FileName;
                                                    <a href=@str1 target="_blank" class="text-decoration-none"> <button class="btn btn-info text-white " id=@str type="button">View</button></a>
                                                    }
                                                    else
                                                    {
                                                        var str = "savebtn" + id1;
                                                    <button class="btn btn-info text-white " type="submit" style="display:none;" id="@str">Save</button>
                                                    }
                                            </td>
                                        </tr>
                                        </form>
                                        id1++;
                                    }
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div class="row text-end">
            <div class="col">
                <a class="btn btn-info text-white ms-4" asp-action="FinalizeTimesheet" asp-route-TimesheetId="@Model.First().InvoiceId"> Finalize</a>
            </div>
        </div>
    </div>
</div>
<script>
    function EditReceipt(id1) {
        debugger;
        document.getElementById("edit" + id1).style.display = "none";
        document.getElementById("view" + id1).style.display = "none";
        document.getElementById("delete" + id1).style.display = "none";
        document.getElementById("save" + id1).style.display = "inline";
        document.getElementById("cancel" + id1).style.display = "inline";
        document.getElementById("item" + id1).removeAttribute("disabled");
        document.getElementById("amount" + id1).removeAttribute("disabled");
    }
    function EditReimbursement(id1) {
        debugger;
        var ItemValue = document.getElementById("item" + id1).value;
        var AmountValue = document.getElementById("amount" + id1).value;
        var Startday = document.getElementById("StartDate").value;
        window.location.href = "/Provider/EditReimbursement?StartDate1=" + Startday + "&Item=" + ItemValue + "&Amount=" + AmountValue + "&Gap=" + id1;
    }
    function SaveData(id1) {
        debugger;
        var filename = document.getElementById("ReceiptFile" + id1).value;
        var extension = filename.split('.').pop();
        if (extension != "pdf") {
            alert("Please Choose PDF file!!");
            document.getElementById("ReceiptFile" + id1).value = "";
        }
        else
            document.getElementById("savebtn" + id1).style.display = "inline";
    }
    function CancelReimbursement(id1) {
        debugger;
        document.getElementById("item" + id1).value = document.getElementById("itemVal" + id1).value;
        document.getElementById("amount" + id1).value = document.getElementById("amountVal" + id1).value;
        document.getElementById("edit" + id1).style.display = "inline";
        document.getElementById("view" + id1).style.display = "inline";
        document.getElementById("delete" + id1).style.display = "inline";
        document.getElementById("save" + id1).style.display = "none";
        document.getElementById("cancel" + id1).style.display = "none";
        document.getElementById("item" + id1).setAttribute("disabled", "");
        document.getElementById("amount" + id1).setAttribute("disabled", "");
    }
    function OpenReceipt() {
        debugger;
        var t = document.getElementById("ReceiptForm").style.display == 'block';
        if (t)
            document.getElementById("ReceiptForm").style.display = 'none';
        else
            document.getElementById("ReceiptForm").style.display = 'block';
    }
</script>
<script>
    function Enablefile(id1) {
        debugger;
        var itemValue = document.getElementById("item" + id1).value;
        var amountValue = document.getElementById("amount" + id1).value;
        if (itemValue != "" && amountValue != 0) {
            document.getElementById("ReceiptFile" + id1).removeAttribute("disabled");
        }
        else {
            document.getElementById("ReceiptFile" + id1).setAttribute("disabled", "");
        }
    }
</script>
<script>
    document.getElementById("invoicing").classList.add("active");
</script>
